#include "position_p.h"

// ????? P ???????
typedef struct {
    float Kp;          // ?????????????
    float output_max;  // ????????? (rad/s)
    float output_min;  // ?????????? (rad/s)
    float feeforward;  // ??????? 0.7-0.9
} Position_Controller;

// **????? P ????????**
void Position_Controller_Init(Position_Controller *pos, float Kp, float output_max, float output_min, float feeforward) {
    pos->Kp = Kp;
    pos->output_max = output_max;
    pos->output_min = output_min;
    pos->feeforward = feeforward;
}

// **????? P ???????**
float Position_Controller_Update(Position_Controller *pos, float position_ref, float position_actual) {
    float error = position_ref - position_actual;  // ???????????
    float velocity_ref = pos->Kp * error + feeforward * position_ref;   // ?????????? ,???????????

    // ???
    if (velocity_ref > pos->output_max) {
        velocity_ref = pos->output_max;
    } else if (velocity_ref < pos->output_min) {
        velocity_ref = pos->output_min;
    }

    return velocity_ref;  // ??????
}
